function e(e,t,r,n){Object.defineProperty(e,t,{get:r,set:n,enumerable:!0,configurable:!0})}var t="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{},r={},n={},o=t.parcelRequire0e29;null==o&&((o=function(e){if(e in r)return r[e].exports;if(e in n){var t=n[e];delete n[e];var o={id:e,exports:{}};return r[e]=o,t.call(o.exports,o,o.exports),o.exports}var i=new Error("Cannot find module '"+e+"'");throw i.code="MODULE_NOT_FOUND",i}).register=function(e,t){n[e]=t},t.parcelRequire0e29=o),o.register("bXuNP",(function(t,r){var n,o;e(t.exports,"register",(()=>n),(e=>n=e)),e(t.exports,"resolve",(()=>o),(e=>o=e));var i={};n=function(e){for(var t=Object.keys(e),r=0;r<t.length;r++)i[t[r]]=e[t[r]]},o=function(e){var t=i[e];if(null==t)throw new Error("Could not resolve bundle with id "+e);return t}})),o("bXuNP").register(JSON.parse('{"2JFQr":"index.fd94b6c3.js","bJmGX":"rtw.db725a81.js","7WKo9":"rtw-trello.edaa1442.js","cX2tx":"spotify.1e0f0708.js","irEM1":"spotify-trello.00774160.js","2Ywgl":"swm.415b8913.js","cHbDk":"princeton.82973572.js"}'));var i={Scope:Object.freeze({Board:"board",Member:"member",Card:"card",Organization:"organization"}),Type:Object.freeze({Challenge:"challenge",Celebrate:"celebrate"}),Visibility:Object.freeze({Shared:"shared",Private:"private"}),Key:Object.freeze({LogEntries:"Log entries",ChallengePreferences:"Challenge preferences"}),Capability:Object.freeze({BoardButtons:"board-buttons",CardBadges:"card-badges",CardButtons:"card-buttons",CardDetailBadges:"card-detail-badges"}),Condition:Object.freeze({Admin:"admin",Edit:"edit",ReadOnly:"readOnly",SignedIn:"signedIn",SignedOut:"signedOut",Always:"always"})};const a=async e=>[{text:"Challenge Toolbox",callback:e=>(async e=>{const t=await e.get(i.Scope.Board,i.Visibility.Shared,i.Key.ChallengePreferences);return e.popup({title:"Toolbox preferences",url:"./popups/board-buttons-popup-authors.html",args:{myArgs:t}})})(e),condition:i.Condition.Always}];var s=class{constructor(e=i.Type.Challenge){this.type=e,this.log=[],this.currentPledge={},this.context={},this.currentReason={}}islogTruthy(e){return null!=e&&e!==[]&&Object.entries(e).length>0||"number"==typeof e}islogFalsy(e){return!this.islogTruthy(e)}isLogEmpty(){return this.log===[]}getLog(){return this.log}setLog(e){return this.log=e,this.log}setType(e){return this.type=e,this.type}getCurrentPledge(){return this.currentPledge}addPledgeToLog(){return this.log.push({type:this.type,board:this.context.board,member:this.context.member,card:this.context.card,pledge:{id:this.currentPledge.id,text:this.currentPledge.text,reasons:[]}}),{isPledgeNowLogged:!0,updatedPledges:this.log.map((e=>e.pledge)).filter((e=>e.type===this.type))}}removePledgeFromLog(){return this.isLogEmpty()?{isPledgeNowLogged:!1,updatedPledges:[]}:this.getReasonsForCurrentPledge(this.currentPledge).length>0?{isPledgeNowLogged:!1,updatedPledges:this.log.map((e=>e.pledge))}:(this.log=this.log.filter((e=>e.pledge.id!==this.currentPledge.id&&e.type===this.type)),{isPledgeNowLogged:!1,updatedPledges:this.log.map((e=>e.pledge)).filter((e=>e.type===this.type))})}togglePledge(e,t){this.currentPledge=t,this.context=e;const r=!this.isLogEmpty()&&this.islogTruthy(this.log.find((e=>e.pledge.id===t.id&&e.type===this.type))),{isPledgeNowLogged:n,updatedPledges:o}=r?this.removePledgeFromLog():this.addPledgeToLog();return{isPledgeNowLogged:n,updatedPledges:o}}getLoggedPledges(){return this.log.map((e=>e.pledge))}getReasonsForCurrentPledge(){if(this.islogFalsy(this.currentPledge)||this.isLogEmpty())return[];const e=this.log.find((e=>e.pledge.id===this.currentPledge.id&&e.type===this.type)).pledge.reasons;return void 0===e?[]:e}addReasonToPledge(){const e=[...this.getReasonsForCurrentPledge(),this.currentReason],t=[...this.getReasonsForCurrentPledge(),this.currentReason];return this.log.find((e=>e.pledge.id===this.currentPledge.id&&e.type===this.type)).pledge.reasons=e,{isReasonNowLogged:!0,updatedReasons:t}}removeReasonFromPledge(){return this.log.find((e=>e.pledge.id===this.currentPledge.id&&e.type===this.type)).pledge.reasons=this.log.find((e=>e.pledge.id===this.currentPledge.id&&e.type===this.type)).pledge.reasons.filter((e=>e.id!==this.currentReason.id)),{isReasonNowLogged:!1,updatedReasons:this.log.find((e=>e.pledge.id===this.currentPledge.id&&e.type===this.type)).pledge.reasons}}toggleReason(e){if(this.currentPledge==={})return;this.currentReason=e;const t=!!this.log.find((e=>e.pledge.id===this.currentPledge.id&&e.type===this.type))&&!!this.log.find((t=>t.pledge.id===this.currentPledge.id&&t.type===this.type&&t.pledge.reasons.find((t=>t.id===e.id)))),{isReasonNowLogged:r,updatedReasons:n}=t?this.removeReasonFromPledge():this.addReasonToPledge();return{isReasonNowLogged:r,updatedReasons:n}}getReasonsCount(){const e=this.log.find((e=>e.pledge.id===this.currentPledge.id&&e.type===this.type)),t=void 0!==e&&e.pledge.reasons?e.pledge.reasons:[],r=t.length>0?t.length:0;return 0===r?"":r.toString()}getReasonsCountByPledge(e){const t=this.log.find((t=>t.pledge.id===e&&t.type===this.type)),r=void 0!==t&&t.pledge.reasons?t.pledge.reasons:[],n=r.length>0?r.length:0;return 0===n?"":n.toString()}static getButtonText(e,t){let r="";switch(e){case i.Type.Challenge:r=t>0?`Challenges (${t})`:"Challenge";break;case i.Type.Celebrate:r=t>0?`Celebrations (${t})`:"Celebrate"}return r}static getChallengeBadgeCounts(e,t){if(void 0===t)return{challenges:0,celebrations:0};const r=e.card;return{challenges:[...new Set(t.filter((e=>e.type===i.Type.Challenge&&e.card===r)).map((e=>e.member)))].length,celebrations:[...new Set(t.filter((e=>e.type===i.Type.Celebrate&&e.card===r)).map((e=>e.member)))].length}}static getCustomBadgeCounts(e,t,r={}){if(void 0===t)return r.count=0,r;const n=e.card,o=[...new Set(t.filter((e=>e.pledge.id===r.id&&e.card===n)).map((e=>e.member)))].length;return r.count=o,r}static getChallengePledgeCounts(e,t){if(void 0===t)return{challenges:0,celebrations:0};const r=e.card;return{challenges:t.filter((e=>e.type===i.Type.Challenge&&e.card===r)).length,celebrations:t.filter((e=>e.type===i.Type.Celebrate&&e.card===r)).length}}};const l=(e,t)=>(async e=>{const t=i.Scope.Card,r=i.Visibility.Shared,n=i.Key.LogEntries,o=i.Capability.CardBadges,a=await e.get(t,r,n);console.log(`Data stored for ${n} against ${t} with ${r} access for ${o}  : `,a);const l=e.getContext();console.log("Context for card badges: ",l);const{challenges:c,celebrations:d}=s.getChallengeBadgeCounts(l,a),g=s.getButtonText(i.Type.Challenge,c),u=s.getButtonText(i.Type.Celebrate,d);if(console.log(`Current value for ${n} for card-badges`,a),0===c&&0===d)return[];const h=[{text:g,color:"red"},{text:u,color:"green"}],p=[];return 0!==c&&p.push(h[0]),0!==c&&p.push(h[1]),e.card("id","name").then((function(e){return p}))})(e),c=(e,t)=>(async e=>{const t=i.Scope.Card,r=i.Visibility.Shared,n=i.Key.LogEntries,o=i.Capability.CardButtons,a=await e.get(t,r,n);console.log(`Data stored for ${n} against ${t} with ${r} access for ${o}  : `,a);const l=e.getContext();console.log("Context for card badges: ",l);const{challenges:c,celebrations:d}=s.getChallengeBadgeCounts(l,a),g=s.getButtonText(i.Type.Challenge,c),u=s.getButtonText(i.Type.Celebrate,d),h=e=>{console.log("onCloseChallengToolbox")},p=await e.card("name").get("name");return console.log("card: ",JSON.stringify(p,null,2)),[{icon:"https://cdn.hyperdev.com/us-east-1%3A3d31b21c-01a0-4da2-8827-4bc6e88b7618%2Ficon-gray.svg",text:g,condition:i.Condition.Always,callback:function(e){return e.modal({title:"Challenge",args:{type:i.Type.Challenge},url:"./modals/challenge.html",fullscreen:!1,height:500,callback:h})}},{icon:"https://cdn.hyperdev.com/us-east-1%3A3d31b21c-01a0-4da2-8827-4bc6e88b7618%2Ficon-gray.svg",text:u,condition:i.Condition.Always,callback:function(e){return e.modal({title:"Celebrate",args:{type:i.Type.Celebrate},url:"./modals/celebrate.html",fullscreen:!1,height:500})}}]})(e);var d=function(e){var t,r=Object.prototype,n=r.hasOwnProperty,o="function"==typeof Symbol?Symbol:{},i=o.iterator||"@@iterator",a=o.asyncIterator||"@@asyncIterator",s=o.toStringTag||"@@toStringTag";function l(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{l({},"")}catch(e){l=function(e,t,r){return e[t]=r}}function c(e,t,r,n){var o=t&&t.prototype instanceof y?t:y,i=Object.create(o.prototype),a=new S(n||[]);return i._invoke=function(e,t,r){var n=g;return function(o,i){if(n===h)throw new Error("Generator is already running");if(n===p){if("throw"===o)throw i;return O()}for(r.method=o,r.arg=i;;){var a=r.delegate;if(a){var s=T(a,r);if(s){if(s===f)continue;return s}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if(n===g)throw n=p,r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);n=h;var l=d(e,t,r);if("normal"===l.type){if(n=r.done?p:u,l.arg===f)continue;return{value:l.arg,done:r.done}}"throw"===l.type&&(n=p,r.method="throw",r.arg=l.arg)}}}(e,r,a),i}function d(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}e.wrap=c;var g="suspendedStart",u="suspendedYield",h="executing",p="completed",f={};function y(){}function b(){}function m(){}var v={};l(v,i,(function(){return this}));var w=Object.getPrototypeOf,C=w&&w(w(N([])));C&&C!==r&&n.call(C,i)&&(v=C);var P=m.prototype=y.prototype=Object.create(v);function x(e){["next","throw","return"].forEach((function(t){l(e,t,(function(e){return this._invoke(t,e)}))}))}function L(e,t){function r(o,i,a,s){var l=d(e[o],e,i);if("throw"!==l.type){var c=l.arg,g=c.value;return g&&"object"==typeof g&&n.call(g,"__await")?t.resolve(g.__await).then((function(e){r("next",e,a,s)}),(function(e){r("throw",e,a,s)})):t.resolve(g).then((function(e){c.value=e,a(c)}),(function(e){return r("throw",e,a,s)}))}s(l.arg)}var o;this._invoke=function(e,n){function i(){return new t((function(t,o){r(e,n,t,o)}))}return o=o?o.then(i,i):i()}}function T(e,r){var n=e.iterator[r.method];if(n===t){if(r.delegate=null,"throw"===r.method){if(e.iterator.return&&(r.method="return",r.arg=t,T(e,r),"throw"===r.method))return f;r.method="throw",r.arg=new TypeError("The iterator does not provide a 'throw' method")}return f}var o=d(n,e.iterator,r.arg);if("throw"===o.type)return r.method="throw",r.arg=o.arg,r.delegate=null,f;var i=o.arg;return i?i.done?(r[e.resultName]=i.value,r.next=e.nextLoc,"return"!==r.method&&(r.method="next",r.arg=t),r.delegate=null,f):i:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,f)}function E(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function R(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function S(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(E,this),this.reset(!0)}function N(e){if(e){var r=e[i];if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var o=-1,a=function r(){for(;++o<e.length;)if(n.call(e,o))return r.value=e[o],r.done=!1,r;return r.value=t,r.done=!0,r};return a.next=a}}return{next:O}}function O(){return{value:t,done:!0}}return b.prototype=m,l(P,"constructor",m),l(m,"constructor",b),b.displayName=l(m,s,"GeneratorFunction"),e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===b||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,m):(e.__proto__=m,l(e,s,"GeneratorFunction")),e.prototype=Object.create(P),e},e.awrap=function(e){return{__await:e}},x(L.prototype),l(L.prototype,a,(function(){return this})),e.AsyncIterator=L,e.async=function(t,r,n,o,i){void 0===i&&(i=Promise);var a=new L(c(t,r,n,o),i);return e.isGeneratorFunction(r)?a:a.next().then((function(e){return e.done?e.value:a.next()}))},x(P),l(P,s,"Generator"),l(P,i,(function(){return this})),l(P,"toString",(function(){return"[object Generator]"})),e.keys=function(e){var t=[];for(var r in e)t.push(r);return t.reverse(),function r(){for(;t.length;){var n=t.pop();if(n in e)return r.value=n,r.done=!1,r}return r.done=!0,r}},e.values=N,S.prototype={constructor:S,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(R),!e)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=t)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var r=this;function o(n,o){return s.type="throw",s.arg=e,r.next=n,o&&(r.method="next",r.arg=t),!!o}for(var i=this.tryEntries.length-1;i>=0;--i){var a=this.tryEntries[i],s=a.completion;if("root"===a.tryLoc)return o("end");if(a.tryLoc<=this.prev){var l=n.call(a,"catchLoc"),c=n.call(a,"finallyLoc");if(l&&c){if(this.prev<a.catchLoc)return o(a.catchLoc,!0);if(this.prev<a.finallyLoc)return o(a.finallyLoc)}else if(l){if(this.prev<a.catchLoc)return o(a.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return o(a.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===e||"continue"===e)&&i.tryLoc<=t&&t<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=e,a.arg=t,i?(this.method="next",this.next=i.finallyLoc,f):this.complete(a)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),f},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),R(r),f}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var o=n.arg;R(r)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(e,r,n){return this.delegate={iterator:N(e),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=t),f}},e}({});try{regeneratorRuntime=d}catch(e){"object"==typeof globalThis?globalThis.regeneratorRuntime=d:Function("r","regeneratorRuntime = r")(d)}var g={Authors:Object.freeze({RTW:"rtw",Spotify:"spotify",SWM:"swm",PrinciplesGreen:"pg",Princeton:"princeton"}),Environments:Object.freeze({Trello:"Trello"})};o.register("1L4ef",(function(e,t){e.exports=import("./"+o("bXuNP").resolve("bJmGX")).then((()=>o("b6NUa")))})),o.register("aL8Qr",(function(e,t){e.exports=import("./"+o("bXuNP").resolve("7WKo9")).then((()=>o("bEksa")))})),o.register("aHNJm",(function(e,t){e.exports=import("./"+o("bXuNP").resolve("cX2tx")).then((()=>o("bmO0s")))})),o.register("hL96R",(function(e,t){e.exports=import("./"+o("bXuNP").resolve("irEM1")).then((()=>o("f1e8W")))})),o.register("4Fu9l",(function(e,t){e.exports=import("./"+o("bXuNP").resolve("2Ywgl")).then((()=>o("ffvez")))})),o.register("MsWMT",(function(e,t){e.exports=import("./"+o("bXuNP").resolve("cHbDk")).then((()=>o("epFvb")))}));const u=async e=>{let t,r;return(async()=>{switch(e){case g.Authors.RTW:return t=await o("1L4ef"),r=await o("aL8Qr"),{...t,...r};case g.Authors.Spotify:return t=await o("aHNJm"),r=await o("hL96R"),{...t,...r};case g.Authors.SWM:return t=await o("4Fu9l"),{...t,...r};case g.Authors.Princeton:return t=await o("MsWMT"),{...t,...r}}})()};var h={getTrelloData:async e=>{const t=e.id;return await u(t)},getAuthorDataById:u};var p={getData:async e=>await h.getAuthorDataById(e.id),getCapabilityPreferences:(e,t)=>{const r=e.capabilities.find((e=>e.capability===t));return r&&r.enabled?r.labels:[]},getTrelloLabels:async({pledges:e,log:t,context:r,popup:n=null})=>(console.log("getTrelloLabels log: ",t),n?e.map((e=>({text:`${e.text} ${s.getCustomBadgeCounts(r,t,e)}`,condition:i.Condition.Always,callback:e=>((e,t,r)=>e.popup({title:r.prompt,items:r.effects}))(e,0,n)}))):e.map((e=>({text:e.text,condition:i.Condition.Always,callback:t=>(async(e,t,r)=>{const n=new s,{isPledgeNowLogged:o,updatedPledges:i}=n.togglePledge(t,r);return await e.set(scope,visibility,key,i),await e.get(scope,visibility,key)})(t,r,e)})))),getPopup:async e=>{const t=e.popup;return!t||t&&!t.enabled?null:t}};const f=(e,t)=>(async e=>{const t=e.getContext(),r=await e.get(i.Scope.Card,i.Visibility.Shared,i.Key.LogEntries);let n;r&&void 0!==r&&(n=challengeLog.setLog(r));const o=await e.get(i.Scope.Board,i.Visibility.Shared,i.Key.ChallengePreferences),a=await p.getData(o),s=await p.getCapabilityPreferences(a,i.Capability.CardDetailBadges);return await p.getTrelloLabels({pledges:s,log:n,context:{board:t.board,card:t.card,member:t.member}})})(e);window.TrelloPowerUp.initialize({"board-buttons":(e,t)=>a(),"card-badges":(e,t)=>l(e),"card-buttons":(e,t)=>c(e),"card-detail-badges":(e,t)=>f(e)});
//# sourceMappingURL=index.fd94b6c3.js.map
