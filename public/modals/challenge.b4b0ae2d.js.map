{"mappings":"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","sources":["src/shared/sources.json","src/shared/challenge-log.js","src/modals/challenge.js"],"sourcesContent":["{ \"data\": [\n    {\n        \"name\": \"Principles of Software Engineering\",\n        \"src\": \"https://principles.green/\",\n        \"pledges\": [\n            {\n                \"id\": 1,\n                \"text\": \"carbon efficient\"\n            },            \n            {\n                \"id\": 2,\n                \"text\": \"energy efficient\"\n            }    \n        ],\n        \"reasons\": {\n            \"positive\": [\n                {\n                    \"id\": 1,\n                    \"text\": \"efficient\"\n                },\n                {\n                    \"id\": 2,\n                    \"text\": \"low intensity\"\n                }                \n            ],\n            \"negative\": [\n                {\n                    \"id\": 1,\n                    \"text\": \"inefficient\"\n                },                \n                {\n                    \"id\": 2,\n                    \"text\": \"high intensity\"\n                }                \n            ]\n        },\n        \"selected\": false\n    },\n    {\n        \"name\": \"Sustainable Web Manifesto\",\n        \"src\": \"https://www.sustainablewebmanifesto.com/\",\n        \"pledges\": [\n            {\n                \"id\": 1,\n                \"text\": \"clean\"\n            },            \n            {\n                \"id\": 2,\n                \"text\": \"efficient\"\n            },    \n            {\n                \"id\": 3,\n                \"text\": \"open\"\n            },\n            {\n                \"id\": 4,\n                \"text\": \"honest\"\n            },\n            {\n                \"id\": 5,\n                \"text\": \"regenerative\"\n            },\n            {\n                \"id\": 6,\n                \"text\": \"resilient\"\n            }\n        ],\n        \"reasons\": {\n            \"positive\": [\n                {\n                    \"id\": 1,\n                    \"text\": \"supportive\"\n                },\n                {\n                    \"id\": 2,\n                    \"text\": \"collaborative\"\n                },      \n                {\n                    \"id\": 3,\n                    \"text\": \"fast\"\n                }      \n            ],\n            \"negative\": [\n                {\n                    \"id\": 1,\n                    \"text\": \"obstructive\"\n                },                \n                {\n                    \"id\": 2,\n                    \"text\": \"opaque\"\n                },                \n                {\n                    \"id\": 3,\n                    \"text\": \"slow\"\n                }           \n            ]\n        },\n        \"selected\": false\n    },\n    {\n        \"name\": \"Challenge Toolbox Prototype\",\n        \"src\": \"https://www.figma.com/file/E7ZOq83wqAE6ABfoIXnnVm/Challenge-Toolbox-Prototype?node-'id'=3%3A111\",\n        \"pledges\": [\n            {\n                \"id\": 1,\n                \"text\": \"respect people\"\n            },\n            {\n                \"id\": 2,\n                \"text\": \"protect against abuse\"\n            },\n            {\n                \"id\": 3,\n                \"text\": \"make accessible tech\"\n            },\n            {\n                \"id\": 4,\n                \"text\": \"consider social impacts\"\n            }\n        ],\n        \"reasons\": {\n            \"positive\": [\n                {\n                    \"id\": 1,\n                    \"text\": \"improves well-being\"\n                },                \n                {\n                    \"id\": 2,\n                    \"text\": \"improves privacy\"\n                }            \n            ],\n            \"negative\": [\n                {\n                    \"id\": 1,\n                    \"text\": \"annoying\"\n                },                \n                {\n                    \"id\": 2,\n                    \"text\": \"misleading\"\n                }                \n            ]\n        },\n        \"selected\": true\n    }\n]}","import trelloEnums from './trello-enums';\n\nclass ChallengeLog {\n\n    constructor(type = trelloEnums.Type.Challenge) {\n      this.type = type;\n      this.log = [];\n      this.currentPledge = {};\n      this.context = {};\n      this.currentReason = {};\n    }\n\n    // private \n    islogTruthy(val) {\n        return (val !== null && val !== undefined && val !== [] && Object.entries(val).length > 0 || typeof(val) === 'number' );\n    }\n\n    // private \n    islogFalsy(val) {\n        return !this.islogTruthy(val);\n    }\n\n    // public \n    isLogEmpty() {\n        return this.log === [];\n    }\n  \n    // public\n    getLog() {\n        return this.log;\n    }\n  \n    // public\n    setLog(log) {\n        this.log = log;\n        return this.log;\n    }\n  \n    // public\n    setType(type) {\n        this.type = type;\n        return this.type;\n    }\n\n    // public\n    getCurrentPledge() {\n        return this.currentPledge;\n    }\n\n    // private\n    addPledgeToLog() {\n\n        console.log('addPledgeToLog');\n\n        this.log.push({\n                type: this.type,\n                board: this.context.board,\n                member: this.context.member,\n                card: this.context.card,\n                pledge: {\n                    id: this.currentPledge.id,\n                    text: this.currentPledge.text,\n                    reasons: []\n                },                \n            })\n            return { isPledgeNowLogged: true, updatedPledges: this.log.map(entry => entry.pledge).filter(entry => entry.type === this.type) };\n    };\n    \n    // private\n    removePledgeFromLog() {\n\n        console.log('removePledgeFromLog');\n\n        if(this.isLogEmpty()) return { isPledgeNowLogged: false, updatedPledges: [] };\n        if(this.getReasonsForCurrentPledge(this.currentPledge).length > 0) {\n            return { isPledgeNowLogged: false, updatedPledges: this.log.map(entry => entry.pledge) };\n        }\n        this.log = this.log.filter(entry => entry.pledge.id !== this.currentPledge.id && entry.type === this.type);\n        return { isPledgeNowLogged: false, updatedPledges: this.log.map(entry => entry.pledge).filter(entry => entry.type === this.type) };\n    }\n\n    // public\n    togglePledge(context, pledge) {\n\n        this.currentPledge = pledge;\n        this.context = context;\n\n        console.log('togglePledge this.log ', this.log);\n        \n        console.log('togglePledge this.type ', this.type);\n        \n        console.log('togglePledge this.log ', this.log);\n\n        console.log('this.isLogEmpty() ', this.isLogEmpty());\n\n        console.log('this.log.find(entry => entry.pledge.id === pledge.id) ', this.log.find(entry => entry.pledge.id === pledge.id));\n\n        console.log('this.log.find(entry => entry.pledge.id === pledge.id && entry.type === this.type) ', this.log.find(entry => entry.pledge.id === pledge.id && entry.type === this.type));\n        \n        const isPledgeLogged = this.isLogEmpty() ? false : this.islogTruthy(this.log.find(entry => entry.pledge.id === pledge.id && entry.type === this.type));\n\n        console.log('togglePledge isPledgeLogged ', isPledgeLogged);\n\n        const { isPledgeNowLogged, updatedPledges } = isPledgeLogged\n            ? this.removePledgeFromLog()\n            : this.addPledgeToLog();\n\n        return { isPledgeNowLogged, updatedPledges };\n    }\n\n    // public\n    getLoggedPledges() {\n        return this.log.map(entry => entry.pledge);\n    }\n\n    // public \n    getReasonsForCurrentPledge() {\n        if(this.islogFalsy(this.currentPledge) || this.isLogEmpty()) return [];\n        const reasons = this.log.find(entry => entry.pledge.id === this.currentPledge.id && entry.type === this.type).pledge.reasons;\n        return reasons === undefined ? [] : reasons;\n    }\n\n    // private \n    addReasonToPledge() {\n        const reasons = [ ...this.getReasonsForCurrentPledge(), this.currentReason ];\n        const updatedReasons = [ ...this.getReasonsForCurrentPledge(), this.currentReason ];\n        this.log.find(entry => entry.pledge.id === this.currentPledge.id && entry.type === this.type).pledge.reasons = reasons;\n        return { isReasonNowLogged: true, updatedReasons };\n    }\n\n    // private\n    removeReasonFromPledge() {        \n        this.log.find(entry => entry.pledge.id === this.currentPledge.id && entry.type === this.type).pledge.reasons = this.log.find(entry => entry.pledge.id === this.currentPledge.id && entry.type === this.type).pledge.reasons.filter(r => r.id !== this.currentReason.id);\n        return { isReasonNowLogged: false, updatedReasons: this.log.find(entry => entry.pledge.id === this.currentPledge.id && entry.type === this.type).pledge.reasons };\n    }\n\n    // public\n    toggleReason(reason) {\n\n        if(this.currentPledge === {}) return;\n\n        this.currentReason = reason;\n\n        const isPledgeLogged = !!this.log.find(entry => entry.pledge.id === this.currentPledge.id && entry.type === this.type);\n        const isReasonLogged = isPledgeLogged && !!this.log.find(entry => entry.pledge.id === this.currentPledge.id && entry.type === this.type && entry.pledge.reasons.find(r => r.id === reason.id));\n\n        const { isReasonNowLogged, updatedReasons } = isReasonLogged \n            ? this.removeReasonFromPledge()\n            : this.addReasonToPledge();\n\n        return { isReasonNowLogged, updatedReasons };\n    }\n\n    // public\n    getReasonsCount() {\n        const entry = this.log.find(entry => entry.pledge.id === this.currentPledge.id && entry.type === this.type);\n        const reasons = entry !== undefined ? entry.pledge.reasons ? entry.pledge.reasons : [] : [];\n        const reasonCount = reasons.length > 0 ? reasons.length : 0;\n        return reasonCount === 0 ? '' : reasonCount.toString();\n    }\n\n    // public\n    getReasonsCountByPledge(pledgeId) {\n        const entry = this.log.find(entry => entry.pledge.id === pledgeId && entry.type === this.type);\n        const reasons = entry !== undefined ? entry.pledge.reasons ? entry.pledge.reasons : [] : [];\n        const reasonCount = reasons.length > 0 ? reasons.length : 0;\n        return reasonCount === 0 ? '' : reasonCount.toString();\n    }\n\n    // public static\n    static getButtonText(type, count) {\n     \n        let text = '';\n\n        switch(type) {\n            case trelloEnums.Type.Challenge:\n                text = count > 0\n                    ? `Challenges (${count})`\n                    : `Challenge`;\n                    break;\n            case trelloEnums.Type.Celebrate:\n                text = count > 0\n                    ? `Celebrations (${count})`\n                    : `Celebrate`;\n                    break;\n        }\n\n        // console.warn('button text: ', text);\n\n        return text;\n    }\n\n    // public static\n    static getChallengeBadgeCounts(context, log) {\n\n        if(log === undefined) {\n            return { challenges: 0, celebrations: 0 };\n        }\n\n        const card = context.card;\n        const cardChallengeCount = [ ...new Set(log.filter(e => e.type === trelloEnums.Type.Challenge && e.card === card).map(e => e.member)) ].length;\n        const cardCelebrationCount = [ ...new Set(log.filter(e => e.type === trelloEnums.Type.Celebrate && e.card === card).map(e => e.member)) ].length;\n\n        return {\n            challenges: cardChallengeCount,\n            celebrations: cardCelebrationCount\n        }\n    }\n\n    // public static \n    static getLabelVoteCount(context, log, pledge = {}) {\n\n        if(log === undefined) {            \n            return 0;\n        }\n\n        const card = context.card;\n\n        if(card === undefined || card === null) {\n            console.log('no card');\n            return 0;\n        }\n\n        const count = [ ...new Set(log.filter(e => e.pledge.id === pledge.id && e.card === card).map(e => e.member)) ].length;\n\n        return count;\n    }\n\n    static getChallengePledgeCounts(context, log) {\n\n        if(log === undefined) {\n            return { challenges: 0, celebrations: 0 };\n        }\n\n        const card = context.card;\n        const cardChallengeCount = log.filter(entry => entry.type === trelloEnums.Type.Challenge && entry.card === card).length;\n        const cardCelebrationCount = log.filter(entry => entry.type === trelloEnums.Type.Celebrate && entry.card === card).length;\n\n        return {\n            challenges: cardChallengeCount,\n            celebrations: cardCelebrationCount\n        }\n    }\n};\n\nexport default ChallengeLog;","import regeneratorRuntime from \"regenerator-runtime\";\nimport sources from '../shared/sources.json';\nimport trelloEnums from '../shared/trello-enums';\nimport ChallengeLog from '../shared/challenge-log';\n\nconst init = async () => {\n\n    const isLive = document.referrer === 'https://trello.com/';\n\n    // console.log('isLive: ', isLive);\n\n    const pledges = sources.data.find(s => s.selected).pledges;\n\n    const pledgesContainer = document.getElementById('pledges');\n    const reasonsContainer = document.getElementById('reasons');\n\n    document.getElementById('src').href = sources.data.find(s => s.selected).src;\n\n    const scope = trelloEnums.Scope.Card;\n    const visibility = trelloEnums.Visibility.Shared;\n    const key = trelloEnums.Key.LogEntries;\n    const capability = trelloEnums.Capability.CardButtons;\n\n    let type, t, log;\n\n    if(isLive) {\n\n        t = window.TrelloPowerUp.iframe();\n        log = await t.get(scope, visibility, key);\n        type = t.arg('type');\n\n        // console.log(`Data stored for ${key} against ${scope} with ${visibility} access for ${capability}  : `,  log);    \n\n    } else {\n        type = trelloEnums.Type.Challenge;\n    }\n\n    const challengeLog = new ChallengeLog(type);\n\n    const reasons = type === trelloEnums.Type.Challenge\n        ? sources.data.find(s => s.selected).reasons.negative\n        : sources.data.find(s => s.selected).reasons.positive;\n\n    if(log && log !== undefined) {\n        const updatedLogFromTrello = challengeLog.setLog(log);\n        console.log('set log with log from t: ', updatedLogFromTrello);   \n    }\n\n    const showSelectedPledges = (pledges, currentPledge) => {\n\n        pledgesContainer.querySelectorAll('.btn').forEach(btn => {\n\n            btn.classList.remove('selected');\n            \n            pledges.forEach(pledge => {\n                if (parseInt(currentPledge.id) === parseInt(btn.id)) {\n                    btn.classList.add('selected');\n                }\n            });\n\n            if (parseInt(currentPledge.id) === parseInt(btn.id)) {\n                btn.classList.add('selected');\n            }\n        });\n    };\n\n    const clickPledgeHandler = (e, pledgeId) => {\n        \n        const context = isLive ? t.getContext() : {\n            board: 'board #1',\n            member: 'member #1',\n            card: 'card #1',\n        };\n\n        const pledge = pledges.find(p => parseInt(p.id) === parseInt(pledgeId));\n\n        const { isPledgeNowLogged, updatedPledges } = challengeLog.togglePledge(context, pledge);\n\n        showSelectedPledges(updatedPledges, pledge);\n        redrawChallengeReasons();\n        showSelectedReasons(challengeLog.getReasonsForCurrentPledge());\n    };\n\n    const showSelectedReasons = reasons => {\n\n        reasonsContainer.querySelectorAll('.btn').forEach(btn => {\n\n            btn.classList.remove('selected');\n\n            if(reasons === []) return;\n\n            reasons.forEach(reason => {\n                if (parseInt(reason.id) === parseInt(btn.id)) {\n                    btn.classList.add('selected');\n                } else {\n                    if (reasons.filter(sb => parseInt(sb.id) === parseInt(btn.id)) === []) {\n                        btn.classList.remove('selected');\n                    }\n                }\n            });\n        });\n    };\n\n    const clickReasonHandler = (e, reasonId) => {\n\n        const reason = reasons.find(r => parseInt(r.id) === parseInt(reasonId));\n\n        const { isReasonNowLogged, updatedReasons } = challengeLog.toggleReason(reason);\n\n        showSelectedReasons(updatedReasons);\n\n        redrawChallengePledges();\n    };\n\n    const redrawChallengePledges = () => {\n\n        const pledgeItems = pledges.map(pledge => {\n        \n            const reasonCount = challengeLog.getReasonsCountByPledge(pledge.id);\n\n            const classList = type === trelloEnums.Type.Challenge ? 'btnChallenge' : 'btnCelebrate';\n\n            return `<li>\n                        <button id=\"${pledge.id}\" class=\"btn ${classList}\">${pledge.text}<span class=\"counter\">${reasonCount}</span></button>\n                    </li>`;\n        });\n\n        pledgesContainer.innerHTML = pledgeItems.join('');\n\n        pledgesContainer.querySelectorAll('.btn').forEach(btn => {\n            btn.addEventListener('click', e => clickPledgeHandler(e, btn.id));\n        });\n\n        showSelectedPledges(challengeLog.getLoggedPledges(), challengeLog.getCurrentPledge());\n    };\n\n    redrawChallengePledges();\n\n    const redrawChallengeReasons = () => {\n\n        const reasonItems = reasons.map(reason => {\n            return `<li>\n                        <button id=\"${reason.id}\" class=\"btn btnReason\">${reason.text}</button>\n                    </li>`;\n        });\n        \n        reasonsContainer.innerHTML = reasonItems.join('');\n\n        reasonsContainer.querySelectorAll('.btn').forEach(btn => {\n            btn.addEventListener('click', e => clickReasonHandler(e, btn.id));\n        });\n\n        showSelectedReasons(challengeLog.getReasonsForCurrentPledge());\n    };\n\n    redrawChallengeReasons();\n\n    const submitButton = document.getElementById('submit');\n\n    submitButton.addEventListener('click', async e => {\n\n        if(!isLive) return;\n        \n        const value = challengeLog.getLog();\n\n        await t.set(scope, visibility, key, value);\n\n        const response = await t.get(scope, visibility, key);\n\n        console.log('returned save object: ',  response);\n\n        await t.notifyParent('done');\n\n        return t.closeModal();\n\n    });\n};\n\ninit();\n"],"names":["$d21f854afd0d98a0$exports","JSON","parse","$070c272ef4086d70$export$2e2bcd8739ae039","type","$LdkDU","default","Type","Challenge","this","log","currentPledge","context","currentReason","islogTruthy","val","Object","entries","length","islogFalsy","isLogEmpty","getLog","setLog","setType","getCurrentPledge","addPledgeToLog","console","push","board","member","card","pledge","id","text","reasons","isPledgeNowLogged","updatedPledges","map","entry","filter","removePledgeFromLog","getReasonsForCurrentPledge","togglePledge","find","isPledgeLogged","getLoggedPledges","undefined","addReasonToPledge","updatedReasons","isReasonNowLogged","removeReasonFromPledge","r","toggleReason","reason","isReasonLogged","getReasonsCount","reasonCount","toString","getReasonsCountByPledge","pledgeId","count","Celebrate","challenges","celebrations","Set","e","async","isLive","document","referrer","pledges","$parcel$interopDefault","data","s","selected","pledgesContainer","getElementById","reasonsContainer","href","src","scope","Scope","Card","visibility","Visibility","Shared","key","Key","LogEntries","Capability","CardButtons","t","window","TrelloPowerUp","iframe","get","arg","challengeLog","negative","positive","updatedLogFromTrello","showSelectedPledges","querySelectorAll","forEach","btn","classList","remove","parseInt","add","showSelectedReasons","sb","redrawChallengePledges","pledgeItems","innerHTML","join","addEventListener","getContext","p","redrawChallengeReasons","clickPledgeHandler","reasonItems","reasonId","clickReasonHandler","value","set","response","notifyParent"],"version":3,"file":"challenge.b4b0ae2d.js.map"}