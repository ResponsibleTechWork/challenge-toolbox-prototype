function e(e){return e&&e.__esModule?e.default:e}var t;t=JSON.parse('{"data":[{"name":"Principles of Green Software Engineering","src":"https://principles.green/","pledges":[{"id":1,"text":"carbon efficient"},{"id":2,"text":"energy efficient"}],"reasons":{"positive":[{"id":1,"text":"efficient"},{"id":2,"text":"low intensity"}],"negative":[{"id":1,"text":"inefficient"},{"id":2,"text":"high intensity"}]},"selected":false},{"name":"Sustainable Web Manifesto","src":"https://www.sustainablewebmanifesto.com/","pledges":[{"id":1,"text":"clean"},{"id":2,"text":"efficient"},{"id":3,"text":"open"},{"id":4,"text":"honest"},{"id":5,"text":"regenerative"},{"id":6,"text":"resilient"}],"reasons":{"positive":[{"id":1,"text":"supportive"},{"id":2,"text":"collaborative"},{"id":3,"text":"fast"}],"negative":[{"id":1,"text":"obstructive"},{"id":2,"text":"opaque"},{"id":3,"text":"slow"}]},"selected":false},{"name":"Challenge Toolbox Prototype","src":"https://www.figma.com/file/E7ZOq83wqAE6ABfoIXnnVm/Challenge-Toolbox-Prototype?node-\'id\'=3%3A111","pledges":[{"id":1,"text":"respect people"},{"id":2,"text":"protect against abuse"},{"id":3,"text":"make accessible tech"},{"id":4,"text":"consider social impacts"}],"reasons":{"positive":[{"id":1,"text":"improves well-being"},{"id":2,"text":"improves privacy"}],"negative":[{"id":1,"text":"annoying"},{"id":2,"text":"misleading"}]},"selected":true}]}');var s={Scope:Object.freeze({Board:"board",Member:"member",Card:"card",Organization:"organization"}),Type:Object.freeze({Challenge:"challenge",Celebrate:"celebrate"}),Visibility:Object.freeze({Shared:"shared",Private:"private"}),Key:Object.freeze({LogEntries:"Log entries"}),Capability:Object.freeze({CardBadges:"card-badges",CardButtons:"card-buttons",CardDetailBadges:"card-detail-badges"}),Condition:Object.freeze({Admin:"admin",Edit:"edit",ReadOnly:"readOnly",SignedIn:"signedIn",SignedOut:"signedOut",Always:"always"})};class i{constructor(e){this.type=e,this.log=[],this.currentPledge={},this.context={},this.currentReason={}}islogTruthy(e){return null!=e&&e!==[]&&Object.entries(e).length>0||"number"==typeof e}islogFalsy(e){return!this.islogTruthy(e)}isLogEmpty(){return this.log===[]}getLog(){return this.log}setLog(e){return this.log=e,this.log}setType(e){return this.type=e,this.type}getCurrentPledge(){return this.currentPledge}addPledgeToLog(){return this.log.push({type:this.type,board:this.context.board,member:this.context.member,card:this.context.card,pledge:{id:this.currentPledge.id,text:this.currentPledge.text,reasons:[]}}),{isPledgeNowLogged:!0,updatedPledges:this.log.map((e=>e.pledge)).filter((e=>e.type===this.type))}}removePledgeFromLog(){return this.isLogEmpty()?{isPledgeNowLogged:!1,updatedPledges:[]}:this.getReasonsForCurrentPledge(this.currentPledge).length>0?{isPledgeNowLogged:!1,updatedPledges:this.log.map((e=>e.pledge))}:(this.log=this.log.filter((e=>e.pledge.id!==this.currentPledge.id&&e.type===this.type)),{isPledgeNowLogged:!1,updatedPledges:this.log.map((e=>e.pledge)).filter((e=>e.type===this.type))})}togglePledge(e,t){this.currentPledge=t,this.context=e;const s=!this.isLogEmpty()&&this.islogTruthy(this.log.find((e=>e.pledge.id===t.id&&e.type===this.type))),{isPledgeNowLogged:i,updatedPledges:n}=s?this.removePledgeFromLog():this.addPledgeToLog();return{isPledgeNowLogged:i,updatedPledges:n}}getLoggedPledges(){return this.log.map((e=>e.pledge))}getReasonsForCurrentPledge(){if(this.islogFalsy(this.currentPledge)||this.isLogEmpty())return[];const e=this.log.find((e=>e.pledge.id===this.currentPledge.id&&e.type===this.type)).pledge.reasons;return void 0===e?[]:e}addReasonToPledge(){const e=[...this.getReasonsForCurrentPledge(),this.currentReason],t=[...this.getReasonsForCurrentPledge(),this.currentReason];return this.log.find((e=>e.pledge.id===this.currentPledge.id&&e.type===this.type)).pledge.reasons=e,{isReasonNowLogged:!0,updatedReasons:t}}removeReasonFromPledge(){return this.log.find((e=>e.pledge.id===this.currentPledge.id&&e.type===this.type)).pledge.reasons=this.log.find((e=>e.pledge.id===this.currentPledge.id&&e.type===this.type)).pledge.reasons.filter((e=>e.id!==this.currentReason.id)),{isReasonNowLogged:!1,updatedReasons:this.log.find((e=>e.pledge.id===this.currentPledge.id&&e.type===this.type)).pledge.reasons}}toggleReason(e){if(this.currentPledge==={})return;this.currentReason=e;const t=!!this.log.find((e=>e.pledge.id===this.currentPledge.id&&e.type===this.type))&&!!this.log.find((t=>t.pledge.id===this.currentPledge.id&&t.type===this.type&&t.pledge.reasons.find((t=>t.id===e.id)))),{isReasonNowLogged:s,updatedReasons:i}=t?this.removeReasonFromPledge():this.addReasonToPledge();return{isReasonNowLogged:s,updatedReasons:i}}getReasonsCount(){const e=this.log.find((e=>e.pledge.id===this.currentPledge.id&&e.type===this.type)),t=void 0!==e&&e.pledge.reasons?e.pledge.reasons:[],s=t.length>0?t.length:0;return 0===s?"":s.toString()}getReasonsCountByPledge(e){const t=this.log.find((t=>t.pledge.id===e&&t.type===this.type)),s=void 0!==t&&t.pledge.reasons?t.pledge.reasons:[],i=s.length>0?s.length:0;return 0===i?"":i.toString()}static getButtonText(e,t){let i="";switch(e){case s.Type.Challenge:i=t>0?`Challenges (${t})`:"Challenge";break;case s.Type.Celebrate:i=t>0?`Celebrations (${t})`:"Celebrate"}return i}static getChallengeBadgeCounts(e,t){if(void 0===t)return{challenges:0,celebrations:0};const i=e.card;return{challenges:[...new Set(t.filter((e=>e.type===s.Type.Challenge&&e.card===i)).map((e=>e.member)))].length,celebrations:[...new Set(t.filter((e=>e.type===s.Type.Celebrate&&e.card===i)).map((e=>e.member)))].length}}static getChallengePledgeCounts(e,t){if(void 0===t)return{challenges:0,celebrations:0};const i=e.card;return{challenges:t.filter((e=>e.type===s.Type.Challenge&&e.card===i)).length,celebrations:t.filter((e=>e.type===s.Type.Celebrate&&e.card===i)).length}}}(async()=>{const n="https://trello.com/"===document.referrer;console.log("isLive: ",n);const d=e(t).data.find((e=>e.selected)).pledges,r=document.getElementById("pledges"),o=document.getElementById("reasons");document.getElementById("src").href=e(t).data.find((e=>e.selected)).src;const l=s.Scope.Card,a=s.Visibility.Shared,g=s.Key.LogEntries,c=s.Capability.CardButtons;let p,h,u;n?(h=window.TrelloPowerUp.iframe(),u=await h.get(l,a,g),p=h.arg("type"),console.log(`Data stored for ${g} against ${l} with ${a} access for ${c}  : `,u)):p=s.Type.Challenge;const y=new i(p),f=p===s.Type.Challenge?e(t).data.find((e=>e.selected)).reasons.negative:e(t).data.find((e=>e.selected)).reasons.positive;if(u&&void 0!==u){const e=y.setLog(u);console.log("set log with log from t: ",y.setLog(e))}const b=(e,t)=>{r.querySelectorAll(".btn").forEach((s=>{s.classList.remove("selected"),e.forEach((e=>{parseInt(t.id)===parseInt(s.id)&&s.classList.add("selected")})),parseInt(t.id)===parseInt(s.id)&&s.classList.add("selected")}))},m=e=>{o.querySelectorAll(".btn").forEach((t=>{t.classList.remove("selected"),e!==[]&&e.forEach((s=>{parseInt(s.id)===parseInt(t.id)?t.classList.add("selected"):e.filter((e=>parseInt(e.id)===parseInt(t.id)))===[]&&t.classList.remove("selected")}))}))},P=()=>{const e=d.map((e=>{const t=y.getReasonsCountByPledge(e.id),i=p===s.Type.Challenge?"btnChallenge":"btnCelebrate";return`<li>\n                        <button id="${e.id}" class="btn ${i}">${e.text}<span class="counter">${t}</span></button>\n                    </li>`}));r.innerHTML=e.join(""),r.querySelectorAll(".btn").forEach((e=>{e.addEventListener("click",(t=>((e,t)=>{const s=n?h.getContext():{board:"board #1",member:"member #1",card:"card #1"},i=d.find((e=>parseInt(e.id)===parseInt(t))),{isPledgeNowLogged:r,updatedPledges:o}=y.togglePledge(s,i);b(o,i),C(),m(y.getReasonsForCurrentPledge())})(0,e.id)))})),b(y.getLoggedPledges(),y.getCurrentPledge())};P();const C=()=>{const e=f.map((e=>`<li>\n                        <button id="${e.id}" class="btn btnReason">${e.text}</button>\n                    </li>`));o.innerHTML=e.join(""),o.querySelectorAll(".btn").forEach((e=>{e.addEventListener("click",(t=>((e,t)=>{const s=f.find((e=>parseInt(e.id)===parseInt(t))),{isReasonNowLogged:i,updatedReasons:n}=y.toggleReason(s);m(n),P()})(0,e.id)))})),m(y.getReasonsForCurrentPledge())};C();document.getElementById("submit").addEventListener("click",(async e=>{if(!n)return;const t=y.getLog();await h.set(l,a,g,t);const s=await h.get(l,a,g);return console.log("returned save object: ",s),await h.notifyParent("done"),h.closeModal()}))})();
//# sourceMappingURL=challenge.3f12caf1.js.map
