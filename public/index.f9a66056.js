function e(e){return e&&e.__esModule?e.default:e}var t={Scope:Object.freeze({Board:"board",Member:"member",Card:"card",Organization:"organization"}),Type:Object.freeze({Challenge:"challenge",Celebrate:"celebrate"}),Visibility:Object.freeze({Shared:"shared",Private:"private"}),Key:Object.freeze({LogEntries:"Log entries",ChallengePreferences:"Challenge preferences"}),Capability:Object.freeze({BoardButtons:"board-buttons",CardBadges:"card-badges",CardButtons:"card-buttons",CardDetailBadges:"card-detail-badges"}),Condition:Object.freeze({Admin:"admin",Edit:"edit",ReadOnly:"readOnly",SignedIn:"signedIn",SignedOut:"signedOut",Always:"always"})};var s,o=class{constructor(e){this.type=e,this.log=[],this.currentPledge={},this.context={},this.currentReason={}}islogTruthy(e){return null!=e&&e!==[]&&Object.entries(e).length>0||"number"==typeof e}islogFalsy(e){return!this.islogTruthy(e)}isLogEmpty(){return this.log===[]}getLog(){return this.log}setLog(e){return this.log=e,this.log}setType(e){return this.type=e,this.type}getCurrentPledge(){return this.currentPledge}addPledgeToLog(){return this.log.push({type:this.type,board:this.context.board,member:this.context.member,card:this.context.card,pledge:{id:this.currentPledge.id,text:this.currentPledge.text,reasons:[]}}),{isPledgeNowLogged:!0,updatedPledges:this.log.map((e=>e.pledge)).filter((e=>e.type===this.type))}}removePledgeFromLog(){return this.isLogEmpty()?{isPledgeNowLogged:!1,updatedPledges:[]}:this.getReasonsForCurrentPledge(this.currentPledge).length>0?{isPledgeNowLogged:!1,updatedPledges:this.log.map((e=>e.pledge))}:(this.log=this.log.filter((e=>e.pledge.id!==this.currentPledge.id&&e.type===this.type)),{isPledgeNowLogged:!1,updatedPledges:this.log.map((e=>e.pledge)).filter((e=>e.type===this.type))})}togglePledge(e,t){this.currentPledge=t,this.context=e;const s=!this.isLogEmpty()&&this.islogTruthy(this.log.find((e=>e.pledge.id===t.id&&e.type===this.type))),{isPledgeNowLogged:o,updatedPledges:n}=s?this.removePledgeFromLog():this.addPledgeToLog();return{isPledgeNowLogged:o,updatedPledges:n}}getLoggedPledges(){return this.log.map((e=>e.pledge))}getReasonsForCurrentPledge(){if(this.islogFalsy(this.currentPledge)||this.isLogEmpty())return[];const e=this.log.find((e=>e.pledge.id===this.currentPledge.id&&e.type===this.type)).pledge.reasons;return void 0===e?[]:e}addReasonToPledge(){const e=[...this.getReasonsForCurrentPledge(),this.currentReason],t=[...this.getReasonsForCurrentPledge(),this.currentReason];return this.log.find((e=>e.pledge.id===this.currentPledge.id&&e.type===this.type)).pledge.reasons=e,{isReasonNowLogged:!0,updatedReasons:t}}removeReasonFromPledge(){return this.log.find((e=>e.pledge.id===this.currentPledge.id&&e.type===this.type)).pledge.reasons=this.log.find((e=>e.pledge.id===this.currentPledge.id&&e.type===this.type)).pledge.reasons.filter((e=>e.id!==this.currentReason.id)),{isReasonNowLogged:!1,updatedReasons:this.log.find((e=>e.pledge.id===this.currentPledge.id&&e.type===this.type)).pledge.reasons}}toggleReason(e){if(this.currentPledge==={})return;this.currentReason=e;const t=!!this.log.find((e=>e.pledge.id===this.currentPledge.id&&e.type===this.type))&&!!this.log.find((t=>t.pledge.id===this.currentPledge.id&&t.type===this.type&&t.pledge.reasons.find((t=>t.id===e.id)))),{isReasonNowLogged:s,updatedReasons:o}=t?this.removeReasonFromPledge():this.addReasonToPledge();return{isReasonNowLogged:s,updatedReasons:o}}getReasonsCount(){const e=this.log.find((e=>e.pledge.id===this.currentPledge.id&&e.type===this.type)),t=void 0!==e&&e.pledge.reasons?e.pledge.reasons:[],s=t.length>0?t.length:0;return 0===s?"":s.toString()}getReasonsCountByPledge(e){const t=this.log.find((t=>t.pledge.id===e&&t.type===this.type)),s=void 0!==t&&t.pledge.reasons?t.pledge.reasons:[],o=s.length>0?s.length:0;return 0===o?"":o.toString()}static getButtonText(e,s){let o="";switch(e){case t.Type.Challenge:o=s>0?`Challenges (${s})`:"Challenge";break;case t.Type.Celebrate:o=s>0?`Celebrations (${s})`:"Celebrate"}return o}static getChallengeBadgeCounts(e,s){if(void 0===s)return{challenges:0,celebrations:0};const o=e.card;return{challenges:[...new Set(s.filter((e=>e.type===t.Type.Challenge&&e.card===o)).map((e=>e.member)))].length,celebrations:[...new Set(s.filter((e=>e.type===t.Type.Celebrate&&e.card===o)).map((e=>e.member)))].length}}static getChallengePledgeCounts(e,s){if(void 0===s)return{challenges:0,celebrations:0};const o=e.card;return{challenges:s.filter((e=>e.type===t.Type.Challenge&&e.card===o)).length,celebrations:s.filter((e=>e.type===t.Type.Celebrate&&e.card===o)).length}}};s=JSON.parse('{"authors":[{"name":"ResponsibleTech.Work","title":"ResponsibleTech.Work Pledges"},{"name":"Spotify","title":"Spotify Ethics Assessment"},{"name":"Sustainable Web Manifesto","title":"Sustainable Web Manifesto"},{"name":"Principles.Green","title":"Principles of Green Software Engineering"}]}');const n=async o=>{const n=t.Scope.Board,r=t.Visibility.Shared,l=t.Key.ChallengePreferences,i=(t.Capability.BoardButtons,o.getContext());console.log("Context for board buttons: ",i);const a=e(s).authors.map((e=>({text:e.title,callback:async(e,t,s)=>{console.log("t: ",e),console.log("opts: ",t),console.log("a: ",s),await e.set(n,r,l,s);const o=await e.get(n,r,l);console.log("return saved author: ",o)}})));return[{text:"Challenge Toolbox",callback:e=>(e=>(console.log("t in onBtnClick: ",e),e.popup({title:"Toolbox preferences",items:a})))(e),condition:t.Condition.Always}]},r=(e,s)=>(async e=>{const s=t.Scope.Card,n=t.Visibility.Shared,r=t.Key.LogEntries,l=t.Capability.CardBadges,i=await e.get(s,n,r);console.log(`Data stored for ${r} against ${s} with ${n} access for ${l}  : `,i);const a=e.getContext();console.log("Context for card badges: ",a);const{challenges:g,celebrations:d}=o.getChallengeBadgeCounts(a,i),c=o.getButtonText(t.Type.Challenge,g),h=o.getButtonText(t.Type.Celebrate,d);if(console.log(`Current value for ${r} for card-badges`,i),0===g&&0===d)return[];const p=[{text:c,color:"red"},{text:h,color:"green"}],u=[];return 0!==g&&u.push(p[0]),0!==g&&u.push(p[1]),e.card("id","name").then((function(e){return u}))})(e),l=(e,s)=>(async e=>{const s=t.Scope.Card,n=t.Visibility.Shared,r=t.Key.LogEntries,l=t.Capability.CardButtons,i=await e.get(s,n,r);console.log(`Data stored for ${r} against ${s} with ${n} access for ${l}  : `,i);const a=e.getContext();console.log("Context for card badges: ",a);const{challenges:g,celebrations:d}=o.getChallengeBadgeCounts(a,i),c=o.getButtonText(t.Type.Challenge,g),h=o.getButtonText(t.Type.Celebrate,d),p=e=>{console.log("onCloseChallengToolbox")},u=await e.card("name").get("name");return console.log("card: ",JSON.stringify(u,null,2)),[{icon:"https://cdn.hyperdev.com/us-east-1%3A3d31b21c-01a0-4da2-8827-4bc6e88b7618%2Ficon-gray.svg",text:c,condition:t.Condition.Always,callback:function(e){return e.modal({title:"Challenge",args:{type:t.Type.Challenge},url:"./modals/challenge.html",fullscreen:!1,height:500,callback:p})}},{icon:"https://cdn.hyperdev.com/us-east-1%3A3d31b21c-01a0-4da2-8827-4bc6e88b7618%2Ficon-gray.svg",text:h,condition:t.Condition.Always,callback:function(e){return e.modal({title:"Celebrate",args:{type:t.Type.Celebrate},url:"./modals/celebrate.html",fullscreen:!1,height:500})}}]})(e);window.TrelloPowerUp.initialize({"board-buttons":(e,t)=>((e,t)=>n(e))(e),"card-badges":(e,t)=>r(e),"card-buttons":(e,t)=>l(e)});
//# sourceMappingURL=index.f9a66056.js.map
