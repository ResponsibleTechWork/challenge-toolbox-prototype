function e(e,t,o,r){Object.defineProperty(e,t,{get:o,set:r,enumerable:!0,configurable:!0})}var t="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{},o={},r={},n=t.parcelRequire0e29;null==n&&((n=function(e){if(e in o)return o[e].exports;if(e in r){var t=r[e];delete r[e];var n={id:e,exports:{}};return o[e]=n,t.call(n.exports,n,n.exports),n.exports}var l=new Error("Cannot find module '"+e+"'");throw l.code="MODULE_NOT_FOUND",l}).register=function(e,t){r[e]=t},t.parcelRequire0e29=n),n.register("bXuNP",(function(t,o){var r,n;e(t.exports,"register",(()=>r),(e=>r=e)),e(t.exports,"resolve",(()=>n),(e=>n=e));var l={};r=function(e){for(var t=Object.keys(e),o=0;o<t.length;o++)l[t[o]]=e[t[o]]},n=function(e){var t=l[e];if(null==t)throw new Error("Could not resolve bundle with id "+e);return t}})),n.register("1L4ef",(function(e,t){e.exports=import("./"+n("bXuNP").resolve("bJmGX")).then((()=>n("b6NUa")))})),n.register("aL8Qr",(function(e,t){e.exports=import("./"+n("bXuNP").resolve("7WKo9")).then((()=>n("bEksa")))})),n.register("aHNJm",(function(e,t){e.exports=import("./"+n("bXuNP").resolve("cX2tx")).then((()=>n("bmO0s")))})),n.register("hL96R",(function(e,t){e.exports=import("./"+n("bXuNP").resolve("irEM1")).then((()=>n("f1e8W")))})),n.register("4Fu9l",(function(e,t){e.exports=import("./"+n("bXuNP").resolve("2Ywgl")).then((()=>n("ffvez")))})),n.register("MsWMT",(function(e,t){e.exports=import("./"+n("bXuNP").resolve("cHbDk")).then((()=>n("epFvb")))})),n("bXuNP").register(JSON.parse('{"2JFQr":"index.45dccc18.js","bJmGX":"rtw.051b2f54.js","7WKo9":"rtw-trello.edaa1442.js","cX2tx":"spotify.99cf9a85.js","irEM1":"spotify-trello.2e9b3ada.js","2Ywgl":"swm.415b8913.js","cHbDk":"princeton.82973572.js","dkzSf":"index.acc22900.js"}'));var l={Scope:Object.freeze({Board:"board",Member:"member",Card:"card",Organization:"organization"}),Type:Object.freeze({Challenge:"challenge",Celebrate:"celebrate"}),Visibility:Object.freeze({Shared:"shared",Private:"private"}),Key:Object.freeze({LogEntries:"Log entries",ChallengePreferences:"Challenge preferences"}),Capability:Object.freeze({BoardButtons:"board-buttons",CardBadges:"card-badges",CardButtons:"card-buttons",CardDetailBadges:"card-detail-badges",CardBackSection:"card-back-section"}),Condition:Object.freeze({Admin:"admin",Edit:"edit",ReadOnly:"readOnly",SignedIn:"signedIn",SignedOut:"signedOut",Always:"always"}),Mode:Object.freeze({Label:"label",Popup:"popup",Modal:"modal"})};const i=(e,t)=>(async e=>[{text:"Challenge Toolbox",callback:e=>(async e=>e.popup({title:"Toolbox preferences",url:"./board-buttons-popup-authors.html",height:225}))(e),condition:l.Condition.Always}])();var a=class{constructor(e=l.Type.Challenge){this.type=e,this.log=[],this.currentPledge={},this.context={},this.currentReason={}}islogTruthy(e){return null!=e&&e!==[]&&Object.entries(e).length>0||"number"==typeof e}islogFalsy(e){return!this.islogTruthy(e)}isLogEmpty(){return this.log===[]}getLog(){return this.log}setLog(e){return this.log=e,this.log}setType(e){return this.type=e,this.type}getCurrentPledge(){return this.currentPledge}addPledgeToLog(){const e={type:this.type,board:this.context.board,member:this.context.member,card:this.context.card,pledge:{id:this.currentPledge.id,text:this.currentPledge.text,reasons:[]}};this.log.push(e);return{isPledgeNowLogged:!0,updatedPledges:this.log.filter((e=>e.type===this.type&&e.card===this.context.card))}}removePledgeFromLog(){return this.isLogEmpty()?{isPledgeNowLogged:!1,updatedPledges:[]}:this.getReasonsForCurrentPledge(this.currentPledge).length>0?{isPledgeNowLogged:!1,updatedPledges:this.log.map((e=>e.pledge))}:(this.log=this.log.filter((e=>e.pledge.id!==this.currentPledge.id&&e.type===this.type)),{isPledgeNowLogged:!1,updatedPledges:this.log.filter((e=>e.pledge)).filter((e=>e.type===this.type))})}togglePledge(e,t){this.currentPledge=t,this.context=e;const o=!this.isLogEmpty()&&this.islogTruthy(this.log.find((e=>parseInt(e.pledge.id)===parseInt(t.id)&&e.type===this.type))),{isPledgeNowLogged:r,updatedPledges:n}=o?this.removePledgeFromLog():this.addPledgeToLog();return{isPledgeNowLogged:r,updatedPledges:n}}getLoggedPledges(){return this.log.map((e=>e.pledge))}getReasonsForCurrentPledge(){if(this.islogFalsy(this.currentPledge)||this.isLogEmpty())return[];const e=this.log.find((e=>e.pledge.id===this.currentPledge.id&&e.type===this.type)).pledge.reasons;return void 0===e?[]:e}addReasonToPledge(){const e=[...this.getReasonsForCurrentPledge(),this.currentReason],t=[...this.getReasonsForCurrentPledge(),this.currentReason];return this.log.find((e=>e.pledge.id===this.currentPledge.id&&e.type===this.type)).pledge.reasons=e,{isReasonNowLogged:!0,updatedReasons:t}}removeReasonFromPledge(){return this.log.find((e=>e.pledge.id===this.currentPledge.id&&e.type===this.type)).pledge.reasons=this.log.find((e=>e.pledge.id===this.currentPledge.id&&e.type===this.type)).pledge.reasons.filter((e=>e.id!==this.currentReason.id)),{isReasonNowLogged:!1,updatedReasons:this.log.find((e=>e.pledge.id===this.currentPledge.id&&e.type===this.type)).pledge.reasons}}toggleReason(e){if(this.currentPledge==={})return;this.currentReason=e;const t=!!this.log.find((e=>e.pledge.id===this.currentPledge.id&&e.type===this.type))&&!!this.log.find((t=>t.pledge.id===this.currentPledge.id&&t.type===this.type&&t.pledge.reasons.find((t=>t.id===e.id)))),{isReasonNowLogged:o,updatedReasons:r}=t?this.removeReasonFromPledge():this.addReasonToPledge();return{isReasonNowLogged:o,updatedReasons:r}}getReasonsCount(){const e=this.log.find((e=>e.pledge.id===this.currentPledge.id&&e.type===this.type)),t=void 0!==e&&e.pledge.reasons?e.pledge.reasons:[],o=t.length>0?t.length:0;return 0===o?"":o.toString()}getReasonsCountByPledge(e){const t=this.log.find((t=>t.pledge.id===e&&t.type===this.type)),o=void 0!==t&&t.pledge.reasons?t.pledge.reasons:[],r=o.length>0?o.length:0;return 0===r?"":r.toString()}static getButtonText(e,t){let o="";switch(e){case l.Type.Challenge:o=t>0?`Challenges (${t})`:"Challenge";break;case l.Type.Celebrate:o=t>0?`Celebrations (${t})`:"Celebrate"}return o}static getChallengeBadgeCounts(e,t){if(void 0===t)return{challenges:0,celebrations:0};const o=e.card;return{challenges:[...new Set(t.filter((e=>e.type===l.Type.Challenge&&e.card===o)).map((e=>e.member)))].length,celebrations:[...new Set(t.filter((e=>e.type===l.Type.Celebrate&&e.card===o)).map((e=>e.member)))].length}}static getLabelVoteCount(e,t,o={}){if(void 0===t)return 0;const r=e.card;return[...new Set(t.filter((e=>e.pledge.id===o.id&&e.card===r)).map((e=>e.member)))].length}static getChallengePledgeCounts(e,t){if(void 0===t)return{challenges:0,celebrations:0};const o=e.card;return{challenges:t.filter((e=>e.type===l.Type.Challenge&&e.card===o)).length,celebrations:t.filter((e=>e.type===l.Type.Celebrate&&e.card===o)).length}}};const s=(e,t)=>(async e=>{const t=l.Scope.Card,o=l.Visibility.Shared,r=l.Key.LogEntries,n=await e.get(t,o,r),i=e.getContext(),{challenges:s,celebrations:d}=a.getChallengeBadgeCounts(i,n),g=a.getButtonText(l.Type.Challenge,s),c=a.getButtonText(l.Type.Celebrate,d);if(0===s&&0===d)return[];const p=[{text:g,color:"red"},{text:c,color:"green"}],h=[];return 0!==s&&h.push(p[0]),0!==s&&h.push(p[1]),e.card("id","name").then((function(e){return h}))})(e),d=(e,t)=>(async e=>{const t=l.Scope.Card,o=l.Visibility.Shared,r=l.Key.LogEntries,n=await e.get(t,o,r),i=e.getContext(),{challenges:s,celebrations:d}=a.getChallengeBadgeCounts(i,n),g=a.getButtonText(l.Type.Challenge,s),c=a.getButtonText(l.Type.Celebrate,d),p=e=>{console.log("onCloseChallengToolbox")};return[{icon:"https://cdn.hyperdev.com/us-east-1%3A3d31b21c-01a0-4da2-8827-4bc6e88b7618%2Ficon-gray.svg",text:g,condition:l.Condition.Always,callback:function(e){return e.modal({title:"Challenge",args:{type:l.Type.Challenge},url:"./challenge.html",fullscreen:!1,height:500,callback:p})}},{icon:"https://cdn.hyperdev.com/us-east-1%3A3d31b21c-01a0-4da2-8827-4bc6e88b7618%2Ficon-gray.svg",text:c,condition:l.Condition.Always,callback:function(e){return e.modal({title:"Celebrate",args:{type:l.Type.Celebrate},url:"./modals/celebrate.html",fullscreen:!1,height:500})}}]})(e);n("bDs4w");var g={Authors:Object.freeze({RTW:"rtw",Spotify:"spotify",SWM:"swm",PrinciplesGreen:"pg",Princeton:"princeton"}),Environments:Object.freeze({Trello:"Trello"})};const c=async e=>{let t,o;return(async()=>{switch(e){case g.Authors.RTW:return t=await n("1L4ef"),o=await n("aL8Qr"),{...t,...o};case g.Authors.Spotify:return t=await n("aHNJm"),o=await n("hL96R"),{...t,...o};case g.Authors.SWM:return t=await n("4Fu9l"),{...t,...o};case g.Authors.Princeton:return t=await n("MsWMT"),{...t,...o}}})()};var p={getTrelloData:async e=>{const t=e.id;return await c(t)},getAuthorDataById:c};var h={getData:async e=>await p.getAuthorDataById(e.id),getLabelsByCapability:(e,t)=>{const o=e.capabilities.find((e=>e.capability===t));return o&&o.enabled?o.labels:[]},getTrelloLabels:async({t:e,challengeLog:t,labels:o,log:r,context:n,popup:i=null,modal:s=null,mode:d=l.Mode.Label,scope:g,visibility:c,key:p})=>{const h=(e,t,o)=>{const r=a.getLabelVoteCount(e,t,o);return r&&r.toString()||""};switch(d){case l.Mode.Label:return o.map((o=>({text:`${o.text} ${h(n,r,o)}`,condition:l.Condition.Always,callback:()=>(async({t:e,challengeLog:t,context:o,label:r,scope:n,visibility:l,key:i})=>{const{isPledgeNowLogged:a,updatedPledges:s}=t.togglePledge(o,r);return await e.set(n,l,i,s),await e.get(n,l,i)})({t:e,challengeLog:t,context:n,label:o,scope:g,visibility:c,key:p})})));case l.Mode.Popup:return o.map((o=>({text:`${o.text} ${h(n,r,o)}`,condition:l.Condition.Always,callback:()=>(({t:e,challengeLog:t,context:o,label:r,scope:n,visibility:l,key:i,popup:a})=>e.popup({title:a.prompt,items:a.effects}))({t:e,challengeLog:t,context:n,label:o,scope:g,visibility:c,key:p,popup:i})})));case l.Mode.Modal:return o.map((o=>({text:`${o.text} ${h(n,r,o)}`,condition:l.Condition.Always,callback:()=>(({t:e,challengeLog:t,context:o,label:r,scope:n,visibility:l,key:i,modal:a})=>e.modal({title:a.prompt}))({t:e,challengeLog:t,context:n,label:o,scope:g,visibility:c,key:p,modal:s})})))}},getPopup:async e=>{const t=e.popup;return t||null}};const u=(e,t)=>(async e=>{const t=l.Scope.Card,o=l.Visibility.Shared,r=l.Key.LogEntries,n=e.getContext(),i=await e.get(t,o,r),s=new a(l.Type.Challenge);let d;i&&void 0!==i&&(d=s.setLog(i));const g=await e.get(l.Scope.Board,o,l.Key.ChallengePreferences),c=await h.getData(g),p=await h.getLabelsByCapability(c,l.Capability.CardDetailBadges);return await h.getTrelloLabels({t:e,challengeLog:s,labels:p,log:d,context:{board:n.board,card:n.card,member:n.member},mode:l.Mode.Label,scope:t,visibility:o,key:r})})(e),b=(e,t)=>(async e=>{const t=l.Scope.Card,o=l.Visibility.Shared,r=l.Key.LogEntries,n=(e.getContext(),await e.get(t,o,r)),i=new a(l.Type.Challenge);let s;n&&void 0!==n&&(s=i.setLog(n));const d=await e.get(l.Scope.Board,o,l.Key.ChallengePreferences),g=await h.getData(d);return await h.getLabelsByCapability(g,l.Capability.CardDetailBadges),g&&(console.log("title ",g.title),g.modal&&console.log("modal.prompt ",g.modal.prompt)),{title:"Spotify Ethics Assessment",icon:"https://cdn.hyperdev.com/us-east-1%3A3d31b21c-01a0-4da2-8827-4bc6e88b7618%2Ficon-gray.svg",content:{type:"iframe",url:e.signUrl("./card-back-modal-challenges.html",{data:g}),height:180,action:{text:"My Action",callback:e=>console.log(e)}}}})(e);window.TrelloPowerUp.initialize({"board-buttons":(e,t)=>i(),"card-badges":(e,t)=>s(e),"card-buttons":(e,t)=>d(e),"card-detail-badges":(e,t)=>u(e),"card-back-section":(e,t)=>b(e)});
//# sourceMappingURL=index.45dccc18.js.map
